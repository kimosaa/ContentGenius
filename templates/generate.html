<!DOCTYPE html>
<html>
<head>
    <title>Generate Content - ContentGenius</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand"><h2>✨ ContentGenius</h2></div>
            <div class="nav-links">
                <a href="/dashboard">Dashboard</a>
                <a href="/generate">Generate</a>
                <a href="/logout">Logout</a>
            </div>
        </div>
    </nav>

    <div class="generator container">
        <h1>Generate AI Content</h1>

        <div class="generator-card">
            <div style="margin-bottom: 1rem; padding: 1rem; background: #e3f2fd; border-radius: 8px;">
                <strong>Usage:</strong> {{ subscription.generations_used }} / {{ subscription.generations_limit }} generations used
                {% if subscription.plan == 'free' %}
                <a href="/pricing" style="margin-left: 1rem;">Upgrade for more</a>
                {% endif %}
            </div>

            <form id="generateForm">
                <div class="form-group">
                    <label>Content Type</label>
                    <select name="type" required>
                        <option value="blog_intro">Blog Introduction</option>
                        <option value="blog_post">Complete Blog Post</option>
                        <option value="social_post">Social Media Posts</option>
                        <option value="email">Professional Email</option>
                        <option value="ad_copy">Ad Copy</option>
                        <option value="product_description">Product Description</option>
                        <option value="seo_meta">SEO Meta Description</option>
                        <option value="linkedin_post">LinkedIn Post</option>
                        <option value="tweet">Tweets</option>
                        <option value="video_script">Video Script</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>What do you want to write about?</label>
                    <textarea name="prompt" required placeholder="e.g., The benefits of AI in business automation"></textarea>
                </div>

                <button type="submit" class="btn btn-primary btn-large">Generate Content ✨</button>
            </form>

            <div id="output" class="output-area" style="display: none;">
                <h3>Generated Content:</h3>
                <div id="content"></div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('generateForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const button = e.target.querySelector('button');
            button.textContent = 'Generating...';
            button.disabled = true;

            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);

            try {
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    document.getElementById('output').style.display = 'block';
                    document.getElementById('content').textContent = result.content;

                    // Update usage display
                    const usageDiv = document.querySelector('.generator-card > div');
                    usageDiv.innerHTML = `<strong>Usage:</strong> ${result.usage.used} / ${result.usage.limit} generations used`;

                    // Scroll to output
                    document.getElementById('output').scrollIntoView({ behavior: 'smooth' });
                } else {
                    alert(result.error);
                    if (result.error.includes('limit reached')) {
                        window.location.href = '/pricing';
                    }
                }
            } catch (error) {
                alert('Error generating content: ' + error.message);
            } finally {
                button.textContent = 'Generate Content ✨';
                button.disabled = false;
            }
        });
    </script>
</body>
</html>
